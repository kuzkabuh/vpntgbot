<!--
Версия файла: 1.0.0
Описание: Руководство и правила работы для ИИ-агентов проекта VPN-платформы
Дата изменения: 2025-12-29
-->

# AI AGENTS — MASTER CONTROL GUIDE
Официальный регламент для всех ИИ-агентов, работающих с данным проектом.  
Любые автоматические или полуавтоматические изменения кода, инфраструктуры, конфигураций и документации должны соответствовать данному документу.

---

## 1. МИССИЯ ПРОЕКТА
Проект представляет собой платформу:
- выдачи WireGuard VPN-конфигураций пользователям,
- управления VPN через WG-Easy,
- хранения состояния в PostgreSQL,
- взаимодействия через Telegram-бота,
- с возможностью последующего расширения (тарификация, биллинг, управление локациями).

---

## 2. ТЕКУЩИЙ СТАТУС ПРОЕКТА
- Текущая версия системы: **1.0.0**
- Статус: **Рабочая платформа. MVP стабилизирован.**
- Возможности:
  - запущен backend FastAPI
  - интеграция с PostgreSQL
  - WireGuard управляется через WG-Easy
  - Telegram-бот подключен
  - Nginx проксирует backend
  - архитектура контейнеризирована

---

## 3. ОБЩАЯ АРХИТЕКТУРА

### 3.1. Основные сервисы
- `vpn_backend` — FastAPI приложение
- `vpn_bot` — Telegram-бот
- `vpn_db` — PostgreSQL
- `wg_dashboard` — WG-Easy
- `vpn_nginx` — реверс-прокси
- `docker compose` — консолидация

### 3.2. Ключевые точки доступа
- Backend через Nginx: http://SERVER/health
- WG-Easy UI: http://SERVER:51821/
- WG-Easy API: http://wg_dashboard:51821/api
- UDP WireGuard: 51820/udp

---

## 4. ПРАВИЛА ДЛЯ ИИ-АГЕНТОВ

### 4.1. Абсолютные запреты
ИИ НЕ ДОЛЖЕН:
1. Удалять рабочие файлы без явного указания человека.
2. Менять пароли, токены, SSH-ключи автоматически.
3. Публиковать чувствительные данные.
4. Изменять `.env` или добавлять его в git.
5. Вносить правки в WireGuard-ключи без цели.
6. Менять сетевые порты без причины.
7. Ломать обратную совместимость без обсуждения.

---

## 5. БЕЗОПАСНОСТЬ

### 5.1. Чувствительные данные
Запрещено хранить в репозитории:
- токены ботов
- WG-Easy PASSWORD_HASH исходного пароля
- данные БД
- приватные ключи VPN

Все секреты — только в `.env`.

---

## 6. БАЗА ДАННЫХ
СУБД: PostgreSQL  
Доступ осуществляется ТОЛЬКО через DSN:
```
postgresql+psycopg2://vpn_user:***@vpn_db:5432/vpn_service
```

Требования:
- миграции должны быть безопасными
- таблицы не удаляются без явного одобрения
- архивирование обязательно (в планах авто-бэкап)

---

## 7. WG-EASY И WIREGUARD

Используется:
- WireGuard интерфейс `wg0`
- управление осуществляется через WG-Easy API
- порт 51820/udp занят системой — нельзя перекрывать

В `.env`:
- WG_HOST обязателен
- PASSWORD_HASH обязателен

---

## 8. BACKEND
Backend:
- должен запускаться стабильно
- `/health` всегда должен работать

При изменениях:
- код документируется
- добавляются логи
- соблюдаются стандарты

---

## 9. TELEGRAM BOT
ИИ-агент обязан:
- не изменять токен
- не изменять webhook без причины
- не ломать бизнес-логику
- поддерживать совместимость с backend

---

## 10. NGINX
Нельзя:
- отключать health
- убирать проксирование API

---

## 11. DOCKER
ИИ-агент обязан:
- сохранять структуру docker compose
- не удалять тома без причины
- соблюдать имена контейнеров

---

## 12. БЭКАПЫ
Резервное копирование — обязательное требование проекта.  
Если ИИ добавляет функционал бэкапов, он должен:
- не нарушить работу БД
- не создавать нагрузку
- использовать SSH или локальный архив

---

## 13. ВЕРСИОНИРОВАНИЕ
Используется Semantic Versioning:
```
MAJOR.MINOR.PATCH
```

При изменении ИИ обязан:
1) обновить CHANGELOG  
2) обновить версию  
3) создать тег  

Текущая версия: **1.0.0**

---

## 14. КОНТРОЛЬ КАЧЕСТВА
Любые изменения должны пройти:
- синтаксическую проверку
- логическую проверку
- сетевую проверку
- docker проверку

---

## 15. ПЛАН РАЗВИТИЯ
План:
1) усиление безопасности (JWT + RBAC)
2) управление тарифами
3) биллинг
4) мульти-локации
5) авто-бэкапы
6) web-кабинет
7) аналитика

---

## 16. РЕЖИМЫ РАБОТЫ ИИ
ИИ может:
- анализировать
- документировать
- оптимизировать
- улучшать код

ИИ не может:
- действовать без логики
- принимать критические решения без человека

---

## 17. РЕЗЮМЕ
Если ИИ-агент не уверен — он обязан запросить уточнение.  
Главный приоритет — стабильность, безопасность и предсказуемость системы.

Документ обязателен к соблюдению.
